# 서울시 어린이집 검색/추천 AI 서비스 개발 계획서

## 1. 프로젝트 개요

### 1.1 프로젝트명
**Seoul Daycare Search & Recommendation AI Service**

### 1.2 목적
서울시 어린이집 정보 데이터를 활용하여 학부모가 자연어 질문으로 조건에 맞는 어린이집을 검색하고 추천받을 수 있는 AI 기반 서비스 개발

### 1.3 주요 기능
- 자연어 질문 기반 어린이집 검색
- 위치 기반 검색 (좌표, 시군구)
- 어린이집 유형/특성 필터링 (국공립, 가정, 직장, 장애아통합, 야간연장 등)
- 연령별 반 정보 및 현원/정원 조회
- 시설 정보 필터링 (보육실, 놀이터, CCTV 등)
- AI 요약 응답 + 카드 리스트 + 지도 시각화 + 비교 테이블

---

## 2. 기술 스택

### 2.1 Backend
| 항목 | 기술 | 버전 |
|------|------|------|
| Framework | FastAPI | 0.104+ |
| Orchestration | LangGraph (LangChain) | latest |
| LLM | OpenAI GPT | gpt-4o-mini |
| Embedding | OpenAI | text-embedding-3-large (3072차원) |
| Vector DB | FAISS | IndexFlatL2 |
| Database | SQLite | (어린이집 정보) |
| ORM | SQLAlchemy | 2.0+ |

### 2.2 Frontend
| 항목 | 기술 |
|------|------|
| Framework | Streamlit |
| Layout | 1페이지 (자연어 입력 + 선택적 필터 + 결과 표시) |
| Visualization | Matplotlib (지도), Plotly (차트) |

### 2.3 기타
- Python 3.10+
- Azure OpenAI API (기존 `.env` 설정 재사용)

---

## 3. 시스템 아키텍처

### 3.1 LangGraph 워크플로우 (4단계)

```
사용자 질문
    ↓
┌─────────────────────────────────────────────────────┐
│ 1. Query Analyzer (쿼리 분석)                        │
│    - 자연어 질문 파싱                                │
│    - 의도/카테고리/키워드 추출                       │
│    - 필터 조건 추출 (위치, 유형, 연령, 시설)        │
└─────────────────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────────────────┐
│ 2. Document Retriever (검색)                         │
│    - FAISS 벡터 유사도 검색 (top-k)                 │
│    - SQLite 구조화 필터 검색                         │
│    - 하이브리드 검색 결과 병합                       │
└─────────────────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────────────────┐
│ 3. Answer Generator (응답 생성)                      │
│    - GPT-4o-mini로 자연어 요약 생성                 │
│    - 검색 결과 기반 추천 이유 설명                   │
└─────────────────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────────────────┐
│ 4. Post Processor (후처리)                           │
│    - 응답 품질 검증                                  │
│    - 메타데이터 추가 (검색 결과 수, 필터 적용 등)   │
│    - UI 표시용 데이터 구조화                         │
└─────────────────────────────────────────────────────┘
    ↓
결과 (AI 요약 + 카드 리스트 + 지도 + 비교 테이블)
```

### 3.2 데이터 플로우

```
원본 JSON 데이터
    ↓
전처리 스크립트 (scripts/preprocess_data.py)
    ↓
SQLite DB (구조화된 데이터)
    ↓
임베딩 생성 (어린이집명 + 주소 + 유형 + 제공서비스)
    ↓
FAISS 벡터 인덱스 저장
    ↓
FastAPI 서비스 (검색 API)
    ↓
Streamlit UI (사용자 인터페이스)
```

---

## 4. 데이터 설계

### 4.1 SQLite 데이터베이스 스키마

```sql
-- 어린이집 기본 정보 테이블
CREATE TABLE daycare_centers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    stcode TEXT UNIQUE NOT NULL,              -- 어린이집코드
    crname TEXT NOT NULL,                      -- 어린이집명
    crtypename TEXT,                           -- 어린이집유형
    crstatusname TEXT,                         -- 운영현황
    craddr TEXT,                               -- 주소
    sigunname TEXT,                            -- 시군구명
    zipcode TEXT,                              -- 우편번호
    la REAL,                                   -- 위도
    lo REAL,                                   -- 경도
    crtelno TEXT,                              -- 전화번호
    crfaxno TEXT,                              -- 팩스번호
    crhome TEXT,                               -- 홈페이지

    -- 운영 정보
    crcapat INTEGER,                           -- 정원
    crchcnt INTEGER,                           -- 현원
    crcnfmdt TEXT,                             -- 인가일자
    crabldt TEXT,                              -- 폐지일자
    crpausebegindt TEXT,                       -- 휴지시작일
    crpauseenddt TEXT,                         -- 휴지종료일

    -- 특수 서비스
    crspec TEXT,                               -- 제공서비스
    crcargbname TEXT,                          -- 통학차량운영여부

    -- 시설 정보
    nrtrroomcnt INTEGER,                       -- 보육실수
    nrtrroomsize REAL,                         -- 보육실면적
    plgrdco INTEGER,                           -- 놀이터수
    cctvinstlcnt INTEGER,                      -- CCTV총설치수

    -- 교직원 정보
    chcrtescnt INTEGER,                        -- 보육교직원수
    em_cnt_tot INTEGER,                        -- 교직원총계
    em_cnt_a1 INTEGER,                         -- 원장
    em_cnt_a2 INTEGER,                         -- 보육교사
    em_cnt_a3 INTEGER,                         -- 특수교사
    em_cnt_a7 INTEGER,                         -- 조리원

    -- 근속년수
    em_cnt_0y INTEGER,                         -- 1년미만
    em_cnt_1y INTEGER,                         -- 1년이상~2년미만
    em_cnt_2y INTEGER,                         -- 2년이상~4년미만
    em_cnt_4y INTEGER,                         -- 4년이상~6년미만
    em_cnt_6y INTEGER,                         -- 6년이상

    -- 아동 정보 (연령별)
    child_cnt_tot INTEGER,                     -- 아동수총계
    child_cnt_00 INTEGER,                      -- 만0세
    child_cnt_01 INTEGER,                      -- 만1세
    child_cnt_02 INTEGER,                      -- 만2세
    child_cnt_03 INTEGER,                      -- 만3세
    child_cnt_04 INTEGER,                      -- 만4세
    child_cnt_05 INTEGER,                      -- 만5세
    child_cnt_m2 INTEGER,                      -- 영아혼합(만0~2세)
    child_cnt_m5 INTEGER,                      -- 유아혼합(만3~5세)
    child_cnt_sp INTEGER,                      -- 특수장애

    -- 반 정보
    class_cnt_tot INTEGER,                     -- 반수총계
    class_cnt_00 INTEGER,                      -- 만0세반
    class_cnt_01 INTEGER,                      -- 만1세반
    class_cnt_02 INTEGER,                      -- 만2세반
    class_cnt_03 INTEGER,                      -- 만3세반
    class_cnt_04 INTEGER,                      -- 만4세반
    class_cnt_05 INTEGER,                      -- 만5세반
    class_cnt_m2 INTEGER,                      -- 영아혼합반
    class_cnt_m5 INTEGER,                      -- 유아혼합반
    class_cnt_sp INTEGER,                      -- 특수장애반

    -- 메타데이터
    datastdrdt TEXT,                           -- 데이터기준일자
    work_dttm INTEGER,                         -- 데이터수집일

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 인덱스 생성
CREATE INDEX idx_sigunname ON daycare_centers(sigunname);
CREATE INDEX idx_crtypename ON daycare_centers(crtypename);
CREATE INDEX idx_crstatusname ON daycare_centers(crstatusname);
CREATE INDEX idx_location ON daycare_centers(la, lo);
```

### 4.2 FAISS 벡터 인덱스

**임베딩 대상 텍스트:**
```python
embedding_text = f"{crname} {craddr} {crtypename} {crspec}"
# 예: "자이햇살어린이집 서울특별시 성북구 돌곶이로30길 23 210동 104호 가정 일반"
```

**벡터 차원:** 3072 (text-embedding-3-large)
**인덱스 타입:** `IndexFlatL2` (정확도 우선)
**메타데이터 저장:** `stcode` (어린이집 코드) → SQLite 조인용

---

## 5. 구현 상세

### 5.1 디렉토리 구조

```
seoul-daycare-agent/
├── app/
│   ├── main.py                      # FastAPI 메인 애플리케이션
│   ├── config.py                    # 설정 (환경변수 로드)
│   ├── database/
│   │   ├── models.py                # SQLAlchemy ORM 모델
│   │   ├── database.py              # DB 연결 설정
│   │   └── init_db.py               # DB 초기화 스크립트
│   ├── services/
│   │   ├── embeddings.py            # OpenAI 임베딩 서비스
│   │   ├── vector_store.py          # FAISS 벡터 스토어 관리
│   │   └── preprocessing.py         # 데이터 전처리 로직
│   ├── workflows/
│   │   ├── graph_builder.py         # LangGraph 워크플로우 정의
│   │   └── nodes/
│   │       ├── analyzer.py          # Query Analyzer 노드
│   │       ├── retriever.py         # Document Retriever 노드
│   │       ├── generator.py         # Answer Generator 노드
│   │       └── post_processor.py    # Post Processor 노드
│   ├── api/
│   │   └── routes.py                # FastAPI 라우트 정의
│   └── utils/
│       ├── prompts.py               # LLM 프롬프트 템플릿
│       └── helpers.py               # 유틸리티 함수
├── ui/
│   ├── app.py                       # Streamlit 메인 애플리케이션
│   └── components/
│       ├── search_input.py          # 검색 입력 컴포넌트
│       ├── result_cards.py          # 결과 카드 리스트 컴포넌트
│       ├── map_view.py              # 지도 시각화 컴포넌트
│       └── comparison_table.py      # 비교 테이블 컴포넌트
├── data/
│   ├── raw/
│   │   └── seoul_daycare_raw.json   # 원본 데이터
│   ├── processed/
│   │   └── daycare.db               # SQLite 데이터베이스
│   └── vector_index/
│       ├── faiss.index              # FAISS 인덱스 파일
│       └── metadata.json            # 인덱스 메타데이터
├── scripts/
│   ├── preprocess_data.py           # 데이터 전처리 스크립트
│   └── create_index.py              # 벡터 인덱스 생성 스크립트
├── tests/
│   ├── test_workflow.py             # 워크플로우 테스트
│   ├── test_api.py                  # API 테스트
│   └── test_embedding.py            # 임베딩 테스트
├── docs/
│   └── 개발계획서.md                 # 본 문서
├── .env.example                     # 환경변수 예시
├── requirements.txt                 # Python 의존성
└── README.md                        # 프로젝트 README
```

### 5.2 주요 API 엔드포인트

```
POST /api/v1/search
    - Request Body: { "query": "강남구 국공립 어린이집", "filters": {...} }
    - Response: { "summary": "AI 요약", "results": [...], "total": 10 }

GET /api/v1/daycares/{stcode}
    - Response: 어린이집 상세 정보

POST /api/v1/compare
    - Request Body: { "stcodes": ["11110000157", "11215000368"] }
    - Response: 비교 테이블 데이터

GET /api/v1/districts
    - Response: 시군구 목록

GET /api/v1/types
    - Response: 어린이집 유형 목록
```

### 5.3 Streamlit UI 레이아웃

```
┌─────────────────────────────────────────────────────────┐
│  서울시 어린이집 검색 AI 서비스                        │
├─────────────────────────────────────────────────────────┤
│  [자연어 질문 입력창]                                   │
│  예: "강남구에 있는 국공립 어린이집 추천해줘"          │
│                                                         │
│  [선택적 필터] (접기/펼치기)                            │
│  - 시군구: [드롭다운]                                   │
│  - 어린이집 유형: [다중선택]                            │
│  - 연령: [만0세, 만1세, ...]                            │
│  - 시설: CCTV [슬라이더], 놀이터 [체크박스]            │
│                                                         │
│  [검색] 버튼                                            │
├─────────────────────────────────────────────────────────┤
│  [AI 요약 응답]                                         │
│  검색 결과 10개 중 상위 5개를 추천합니다...            │
├─────────────────────────────────────────────────────────┤
│  [결과 탭]                                              │
│  ┌─────┬─────┬─────┬─────┐                             │
│  │ 리스트│ 지도│ 비교│ 통계│                             │
│  └─────┴─────┴─────┴─────┘                             │
│                                                         │
│  [리스트 탭]                                            │
│  ┌────────────────────────────────┐                    │
│  │ 🏫 자이햇살어린이집              │                    │
│  │ 유형: 가정 | 정원: 20명          │                    │
│  │ 주소: 서울특별시 성북구...       │                    │
│  │ [상세보기] [비교 추가]           │                    │
│  └────────────────────────────────┘                    │
│  ... (더보기)                                           │
└─────────────────────────────────────────────────────────┘
```

---

## 6. 개발 단계 (구현 순서)

### Phase 1: 데이터 준비 및 인프라 구축 ✅ 완료
1. ✅ 프로젝트 디렉토리 구조 생성
2. ✅ 환경 설정 (.env, requirements.txt)
3. ✅ 데이터 전처리 스크립트 작성 (`scripts/preprocess_data.py`)
4. ✅ SQLite 데이터베이스 생성 및 데이터 로드 (9,529개 레코드)
5. ✅ FAISS 벡터 인덱스 생성 (`scripts/create_index.py`) (4,078개 활성)

### Phase 2: Backend 개발 ✅ 완료
6. ✅ FastAPI 기본 구조 생성 (`app/main.py`, `app/config.py`)
7. ✅ SQLAlchemy ORM 모델 정의 (`app/database/models.py`)
8. ✅ 임베딩 서비스 구현 (`app/services/embeddings.py`)
9. ✅ FAISS 벡터 스토어 관리 (`app/services/vector_store.py`)
10. ✅ LangGraph 워크플로우 4단계 노드 구현
    - ✅ Query Analyzer
    - ✅ Document Retriever
    - ✅ Answer Generator
    - ✅ Post Processor
11. ✅ 워크플로우 통합 (`app/workflows/graph_builder.py`)
12. ✅ FastAPI 라우트 구현 (`app/api/routes.py`) - 6개 엔드포인트

### Phase 3: Frontend 개발 ✅ 완료
13. ✅ Streamlit 기본 UI 구조 (`ui/app.py`)
14. ✅ 검색 입력 컴포넌트 (메인 UI에 통합)
15. ✅ 결과 카드 컴포넌트 (리스트 탭)
16. ✅ 지도 시각화 컴포넌트 (지도 탭)
17. ✅ 비교 테이블 컴포넌트 (비교 탭)

### Phase 4: 테스트 및 최적화 ✅ 완료
18. ✅ 단위 테스트 작성 (`tests/test_backend.py`, `tests/test_api.py`)
19. ✅ 워크플로우 통합 테스트 (`tests/test_workflow_detailed.py`)
20. ✅ Windows 인코딩 이슈 해결
21. ✅ README 및 문서 작성

---

## 7. 환경 변수 (.env)

```bash
# Azure OpenAI Configuration (기존 .env 재사용)
AOAI_API_KEY=<your-api-key>
AOAI_ENDPOINT=https://<your-resource>.openai.azure.com/
AOAI_API_VERSION=2024-05-01-preview
AOAI_DEPLOY_GPT4O=gpt-4o-mini
AOAI_EMBEDDING_DEPLOYMENT=text-embedding-3-large

# Database
DB_PATH=data/processed/daycare.db

# Vector Index
VECTOR_INDEX_PATH=data/vector_index/faiss.index
VECTOR_METADATA_PATH=data/vector_index/metadata.json

# API Configuration
API_HOST=localhost
API_PORT=8000

# Streamlit
STREAMLIT_PORT=8501

# Search Configuration
TOP_K=10
SIMILARITY_THRESHOLD=0.7
```

---

## 8. 주요 의존성 (requirements.txt)

```txt
# FastAPI
fastapi==0.104.1
uvicorn[standard]==0.24.0
pydantic==2.5.0

# LangChain & LangGraph
langchain==0.1.0
langgraph==0.0.20
langchain-openai==0.0.2

# Vector Store
faiss-cpu==1.7.4

# Database
sqlalchemy==2.0.23
aiosqlite==0.19.0

# OpenAI
openai==1.3.0

# Streamlit
streamlit==1.29.0

# Visualization
matplotlib==3.8.2
plotly==5.18.0

# Utilities
python-dotenv==1.0.0
pydantic-settings==2.1.0
```

---

## 9. 주요 프롬프트 템플릿 예시

### 9.1 Query Analyzer 프롬프트

```python
QUERY_ANALYZER_PROMPT = """
당신은 어린이집 검색 쿼리를 분석하는 전문가입니다.
사용자 질문에서 다음 정보를 추출하세요:

1. 검색 의도 (search_intent):
   - find_nearby: 위치 기반 검색
   - filter_type: 유형별 필터링
   - compare: 비교 요청
   - general_info: 일반 정보 문의

2. 필터 조건 (filters):
   - district: 시군구명 (예: "강남구", "성북구")
   - type: 어린이집 유형 (예: "국공립", "가정", "직장")
   - age: 연령 (예: "만0세", "만1세")
   - special_service: 특수 서비스 (예: "장애아통합", "야간연장")
   - has_playground: 놀이터 유무 (true/false)
   - min_cctv: 최소 CCTV 수

3. 검색 키워드 (keywords): 자유 텍스트 키워드 리스트

사용자 질문: {query}

JSON 형식으로 응답하세요.
"""
```

### 9.2 Answer Generator 프롬프트

```python
ANSWER_GENERATOR_PROMPT = """
당신은 학부모에게 어린이집 정보를 친절하게 설명하는 전문 상담사입니다.

사용자 질문: {query}

검색된 어린이집 정보:
{search_results}

다음 형식으로 응답하세요:
1. 검색 결과 요약 (1-2문장)
2. 상위 추천 어린이집 3개와 추천 이유
3. 추가 고려사항 (선택적)

자연스럽고 이해하기 쉬운 한국어로 작성하세요.
"""
```

---

## 10. 예상 시연 시나리오

### 시나리오 1: 위치 기반 검색
**사용자 입력:**
"성북구에 있는 국공립 어린이집 중 놀이터가 있는 곳 알려줘"

**Query Analyzer 출력:**
```json
{
  "search_intent": "filter_type",
  "filters": {
    "district": "성북구",
    "type": "국공립",
    "has_playground": true
  },
  "keywords": ["놀이터"]
}
```

**검색 결과:** 3개 어린이집
**AI 응답:**
"성북구의 국공립 어린이집 중 놀이터가 있는 곳을 찾았습니다. 총 3개가 검색되었으며, 상위 추천 어린이집은 다음과 같습니다:

1. **구립벤처타운어린이집** - 정원 45명, 현원 17명으로 여유가 있으며 놀이터와 CCTV 16대가 설치되어 있습니다.
2. ..."

### 시나리오 2: 연령별 검색
**사용자 입력:**
"강동구에서 만0세 반이 있는 어린이집"

**Query Analyzer 출력:**
```json
{
  "search_intent": "filter_type",
  "filters": {
    "district": "강동구",
    "age": "만0세"
  },
  "keywords": ["만0세", "반"]
}
```

---

## 11. 성공 지표 (KPI)

1. **검색 정확도**: 사용자 질문 의도 파악 정확도 > 90%
2. **응답 시간**: 평균 검색 응답 시간 < 2초
3. **사용자 만족도**: UI/UX 사용성 테스트 점수 > 4.0/5.0
4. **시스템 안정성**: API 오류율 < 1%

---

## 12. 향후 확장 계획

1. **Phase 2 기능**
   - 실시간 어린이집 정보 업데이트 (Open API 연동)
   - 사용자 리뷰/평점 시스템 통합
   - 어린이집 대기 현황 조회

2. **Phase 3 기능**
   - 카카오맵/네이버맵 연동
   - 모바일 앱 개발
   - 다국어 지원 (영어, 중국어)

3. **AI 고도화**
   - GPT-4o로 업그레이드
   - 대화형 챗봇 기능
   - 맞춤형 추천 알고리즘

---

## 13. 리스크 관리

| 리스크 | 영향도 | 대응 방안 |
|--------|--------|-----------|
| Azure OpenAI API 장애 | 높음 | TF-IDF 기반 fallback 검색 구현 |
| 데이터 품질 이슈 (null, 잘못된 좌표) | 중간 | 전처리 단계에서 데이터 검증 및 정제 |
| FAISS 인덱스 메모리 부족 | 낮음 | IndexIVFFlat 등 압축 인덱스 고려 |
| Streamlit 성능 저하 | 중간 | 결과 페이징, 캐싱 적용 |

---

## 14. 개발 일정 (실제)

| Phase | 작업 내용 | 상태 | 완료일 |
|-------|-----------|------|--------|
| Phase 1 | 데이터 준비 및 인프라 | ✅ 완료 | 2026-02-04 |
| Phase 2 | Backend 개발 | ✅ 완료 | 2026-02-04 |
| Phase 3 | Frontend 개발 | ✅ 완료 | 2026-02-04 |
| Phase 4 | 테스트 및 최적화 | ✅ 완료 | 2026-02-04 |
| **총계** | **전체 시스템 완성** | **✅ 완료** | **2026-02-04** |

---

## 15. 참고 문서

- [Government Document AI Project](../government-doc-ai-langgraph/)
- [Seoul Night Spots Agent](../06943_63_c06aee0e-9a58-4814-9737-ce1f3233c5c7/)
- [Customer Support MCP System](../customer-support-mcp-system/)
- [LangGraph Documentation](https://langchain-ai.github.io/langgraph/)
- [FAISS Documentation](https://faiss.ai/)

---

**문서 작성일:** 2026-02-04
**작성자:** Claude Code
**버전:** 1.0
